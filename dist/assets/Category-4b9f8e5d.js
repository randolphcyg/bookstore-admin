import{r as S,x as V,g as L,o as N,c as P,w as n,b as y,f as o,k as b,l as g,G as m,n as D,q as z,j as q,s as T,M as U,y as M,d as A,V as O,e as j,E as G,O as w,P as Q,Q as H,R as J,S as K,T as W,U as X}from"./index-7dc32317.js";/* empty css             *//* empty css               *//* empty css              *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css                *//* empty css                  */const Y={class:"dialog-footer"},Z=b("取 消"),ee=b("确 定"),te={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(I,{expose:_}){const i=I,v=S(null),t=V(),e=L({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),d=r=>{g.get(`/categories/${r}`).then(l=>{e.ruleForm={name:l.categoryName,rank:l.categoryRank},e.parentId=l.parentId,e.categoryLevel=l.categoryLevel})},k=r=>{if(e.visible=!0,r)e.id=r,d(r);else{const{level:l=1,parent_id:p=0}=t.query;e.ruleForm={name:"",rank:""},e.parentId=p,e.categoryLevel=l}},C=()=>{e.visible=!1},x=()=>{v.value.validate(r=>{r&&(i.type=="add"?g.post("/categories",{categoryLevel:e.categoryLevel,parentId:e.parentId,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("添加成功"),e.visible=!1,i.reload&&i.reload()}):g.put("/categories",{categoryId:e.id,categoryLevel:e.categoryLevel,parentId:e.categoryLevel,categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("修改成功"),e.visible=!1,i.reload&&i.reload()}))})};return _({open:k,close:C}),(r,l)=>{const p=D,h=z,a=q,s=T,u=U;return N(),P(u,{title:e.type=="add"?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":l[3]||(l[3]=c=>e.visible=c),width:"400px"},{footer:n(()=>[y("span",Y,[o(s,{onClick:l[2]||(l[2]=c=>e.visible=!1)},{default:n(()=>[Z]),_:1}),o(s,{type:"primary",onClick:x},{default:n(()=>[ee]),_:1})])]),default:n(()=>[o(a,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:v,"label-width":"100px",class:"good-form"},{default:n(()=>[o(h,{label:"商品名称",prop:"name"},{default:n(()=>[o(p,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":l[0]||(l[0]=c=>e.ruleForm.name=c)},null,8,["modelValue"])]),_:1}),o(h,{label:"排序值",prop:"rank"},{default:n(()=>[o(p,{type:"number",modelValue:e.ruleForm.rank,"onUpdate:modelValue":l[1]||(l[1]=c=>e.ruleForm.rank=c)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},ae={class:"header"},oe=b("增加"),le=b("批量删除"),ne=["onClick"],re=["onClick"],se=y("a",{style:{cursor:"pointer"}},"删除",-1),ve={__name:"Category",setup(I){const _=S(null),i=M(),v=V(),t=L({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});A(()=>{d()}),O(()=>{console.log(t.pageSize)});const e=i.afterEach(a=>{["category","level2","level3"].includes(a.name)&&d()});j(()=>{e()});const d=()=>{const{level:a=1,parent_id:s=0}=v.query;t.loading=!0,g.get("/categories",{params:{pageNumber:t.currentPage,pageSize:t.pageSize,categoryLevel:a,parentId:s}}).then(u=>{t.tableData=u.list,t.total=u.totalCount,t.currentPage=u.currPage,t.loading=!1,t.level=a,t.parentId=s})},k=a=>{t.currentPage=a,d()},C=a=>{const s=a.categoryLevel+1;if(s==4){m.error("没有下一级");return}i.push({name:`level${s}`,query:{level:s,parent_id:a.categoryId}})},x=()=>{t.type="add",_.value.open()},r=a=>{t.type="edit",_.value.open(a)},l=a=>{t.multipleSelection=a},p=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}g.delete("/categories",{data:{ids:t.multipleSelection.map(a=>a.categoryId)}}).then(()=>{m.success("删除成功"),d()})},h=a=>{g.delete("/categories",{data:{ids:[a]}}).then(()=>{m.success("删除成功"),d()})};return(a,s)=>{const u=T,c=Q,f=H,$=J,R=K,B=G;return N(),P(B,{class:"category-container"},{header:n(()=>[y("div",ae,[o(u,{type:"primary",icon:w(W),onClick:x},{default:n(()=>[oe]),_:1},8,["icon"]),o(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:p},{reference:n(()=>[o(u,{type:"danger",icon:w(X)},{default:n(()=>[le]),_:1},8,["icon"])]),_:1})])]),default:n(()=>[o($,{load:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:l},{default:n(()=>[o(f,{type:"selection",width:"55"}),o(f,{prop:"categoryName",label:"分类名称"}),o(f,{prop:"categoryRank",label:"排序值",width:"120"}),o(f,{prop:"createTime",label:"添加时间",width:"200"}),o(f,{label:"操作",width:"220"},{default:n(F=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>r(F.row.categoryId)},"修改",8,ne),y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>C(F.row)},"下级分类",8,re),o(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:E=>h(F.row.categoryId)},{reference:n(()=>[se]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),o(R,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:k},null,8,["total","page-size","current-page"]),o(te,{ref_key:"addCate",ref:_,reload:d,type:t.type},null,8,["type"])]),_:1})}}};export{ve as default};
