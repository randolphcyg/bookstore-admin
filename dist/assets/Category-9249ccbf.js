import{r as S,u as V,d as B,o as L,c as N,w as n,b as y,f as l,i as b,j as g,F as m,k as z,m as D,h as q,n as P,L as U,v as M,z as A,U as O,V as j,E as Q,N as w,O as G,P as H,Q as J,R as K,S as W,T as X}from"./index-a28300c9.js";/* empty css             *//* empty css               *//* empty css              *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                   *//* empty css                *//* empty css                  */const Y={class:"dialog-footer"},Z=b("取 消"),ee=b("确 定"),te={__name:"DialogAddCategory",props:{type:String,reload:Function},setup(F,{expose:_}){const i=F,v=S(null),t=V(),e=B({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:1},rules:{name:[{required:"true",message:"名称不能为空",trigger:["change"]}],rank:[{required:"true",message:"编号不能为空",trigger:["change"]}]},id:""}),d=r=>{g.get(`/categories/${r}`).then(o=>{e.ruleForm={name:o.mallBooksCategory.categoryName,rank:o.mallBooksCategory.categoryRank},e.parentId=o.mallBooksCategory.parentId,e.categoryLevel=o.mallBooksCategory.categoryLevel})},k=r=>{if(e.visible=!0,r)e.id=r,d(r);else{const{level:o=1,parent_id:p=0}=t.query;e.ruleForm={name:"",rank:1},e.parentId=p,e.categoryLevel=o}},C=()=>{e.visible=!1},I=()=>{v.value.validate(r=>{if(r)if(i.type==="add"){let o={categoryLevel:parseInt(e.categoryLevel),parentId:parseInt(e.parentId),categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank};g.post("/categories",o).then(()=>{m.success("添加成功"),e.visible=!1,i.reload&&i.reload()})}else g.put("/categories",{categoryId:e.id,categoryLevel:parseInt(e.categoryLevel),parentId:parseInt(e.categoryLevel),categoryName:e.ruleForm.name,categoryRank:e.ruleForm.rank}).then(()=>{m.success("修改成功"),e.visible=!1,i.reload&&i.reload()})})};return _({open:k,close:C}),(r,o)=>{const p=z,h=D,a=q,s=P,u=U;return L(),N(u,{title:e.type==="add"?"添加分类":"修改分类",modelValue:e.visible,"onUpdate:modelValue":o[3]||(o[3]=c=>e.visible=c),width:"400px"},{footer:n(()=>[y("span",Y,[l(s,{onClick:o[2]||(o[2]=c=>e.visible=!1)},{default:n(()=>[Z]),_:1}),l(s,{type:"primary",onClick:I},{default:n(()=>[ee]),_:1})])]),default:n(()=>[l(a,{model:e.ruleForm,rules:e.rules,ref_key:"formRef",ref:v,"label-width":"100px",class:"book-form"},{default:n(()=>[l(h,{label:"图书名称",prop:"name"},{default:n(()=>[l(p,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":o[0]||(o[0]=c=>e.ruleForm.name=c)},null,8,["modelValue"])]),_:1}),l(h,{label:"排序值",prop:"rank"},{default:n(()=>[l(p,{type:"number",min:"1",modelValue:e.ruleForm.rank,"onUpdate:modelValue":o[1]||(o[1]=c=>e.ruleForm.rank=c),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}}},ae={class:"header"},oe=b("增加"),le=b("批量删除"),ne=["onClick"],re=["onClick"],se=y("a",{style:{cursor:"pointer"}},"删除",-1),ve={__name:"Category",setup(F){const _=S(null),i=M(),v=V(),t=B({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});A(()=>{d()}),O(()=>{console.log(t.pageSize)});const e=i.afterEach(a=>{["category","level2","level3"].includes(a.name)&&d()});j(()=>{e()});const d=()=>{const{level:a=1,parent_id:s=0}=v.query;t.loading=!0,g.get("/categories",{params:{pageNumber:t.currentPage,pageSize:t.pageSize,categoryLevel:a,parentId:s}}).then(u=>{t.tableData=u.list,t.total=u.totalCount,t.currentPage=u.currPage,t.loading=!1,t.level=a,t.parentId=s})},k=a=>{t.currentPage=a,d()},C=a=>{const s=a.categoryLevel+1;if(s===4){m.error("没有下一级");return}i.push({name:`level${s}`,query:{level:s,parent_id:a.categoryId}})},I=()=>{t.type="add",_.value.open()},r=a=>{t.type="edit",_.value.open(a)},o=a=>{t.multipleSelection=a},p=()=>{if(!t.multipleSelection.length){m.error("请选择项");return}g.delete("/categories",{data:{ids:t.multipleSelection.map(a=>a.categoryId)}}).then(()=>{m.success("删除成功"),d()})},h=a=>{g.delete("/categories",{data:{ids:[a]}}).then(()=>{m.success("删除成功"),d()})};return(a,s)=>{const u=P,c=G,f=H,T=J,$=K,R=Q;return L(),N(R,{class:"category-container"},{header:n(()=>[y("div",ae,[l(u,{type:"primary",icon:w(W),onClick:I},{default:n(()=>[oe]),_:1},8,["icon"]),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:p},{reference:n(()=>[l(u,{type:"danger",icon:w(X)},{default:n(()=>[le]),_:1},8,["icon"])]),_:1})])]),default:n(()=>[l(T,{load:t.loading,ref:"multipleTable",data:t.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:o},{default:n(()=>[l(f,{type:"selection",width:"55"}),l(f,{prop:"categoryName",label:"分类名称"}),l(f,{prop:"categoryRank",label:"排序值",width:"120"}),l(f,{prop:"createTime",label:"添加时间",width:"200"}),l(f,{label:"操作",width:"220"},{default:n(x=>[y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>r(x.row.categoryId)},"修改",8,ne),y("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:E=>C(x.row)},"下级分类",8,re),l(c,{title:"确定删除吗？",confirmButtonText:"确定",cancelButtonText:"取消",onConfirm:E=>h(x.row.categoryId)},{reference:n(()=>[se]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["load","data"]),l($,{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,onCurrentChange:k},null,8,["total","page-size","current-page"]),l(te,{ref_key:"addCate",ref:_,reload:d,type:t.type},null,8,["type"])]),_:1})}}};export{ve as default};
